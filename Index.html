<!DOCTYPE html>

<html lang=\"pt-BR\">

<head>

    <meta charset=\"UTF-8\">

    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">

    <title>📻 Rádio 24H Supermercado do Louro</title>

    

    <!-- Supabase JS SDK -->

    <script src=\"https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2\"></script>

    

    <style>

        * {

            margin: 0;

            padding: 0;

            box-sizing: border-box;

        }

        

        body {

            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;

            background-color: #ffffff;

            color: #333;

            line-height: 1.6;

        }

        

        .container {

            max-width: 1200px;

            margin: 0 auto;

            padding: 20px;

        }

        

        header {

            background: linear-gradient(135deg, #00a86b 0%, #008558 100%);

            color: white;

            padding: 30px 0;

            text-align: center;

            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);

        }

        

        .logo {

            font-size: 2.5em;

            font-weight: bold;

            margin-bottom: 10px;

            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);

        }

        

        .tagline {

            font-size: 1.2em;

            opacity: 0.95;

        }

        

        .player-section {

            background: white;

            border-radius: 15px;

            padding: 40px;

            margin: 40px auto;

            box-shadow: 0 10px 30px rgba(0, 168, 107, 0.1);

            border: 2px solid #00a86b;

        }

        

        .clock-section {

            text-align: center;

            margin-bottom: 30px;

            padding: 20px;

            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);

            border-radius: 10px;

        }

        

        .clock {

            font-size: 3em;

            font-weight: bold;

            color: #00a86b;

            margin-bottom: 10px;

            font-family: 'Courier New', monospace;

        }

        

        .current-hour {

            font-size: 1.5em;

            color: #666;

            margin: 10px 0;

        }

        

        .countdown {

            font-size: 1.2em;

            color: #999;

        }

        

        .live-indicator {

            display: none;

            align-items: center;

            justify-content: center;

            gap: 10px;

            margin: 20px 0;

            padding: 15px;

            background: #00a86b;

            color: white;

            border-radius: 10px;

            font-weight: bold;

            font-size: 1.2em;

        }

        

        .live-dot {

            width: 12px;

            height: 12px;

            background: white;

            border-radius: 50%;

            animation: pulse 1.5s infinite;

        }

        

        @keyframes pulse {

            0%, 100% { opacity: 1; transform: scale(1); }

            50% { opacity: 0.5; transform: scale(1.2); }

        }

        

        .status-section {

            text-align: center;

            margin: 20px 0;

        }

        

        .status-live {

            color: #00a86b;

            font-weight: bold;

            font-size: 1.3em;

        }

        

        .status-offline {

            color: #dc3545;

            font-weight: bold;

            font-size: 1.3em;

        }

        

        .status-message {

            color: #666;

            font-size: 1em;

            margin-top: 10px;

        }

        

        .player-controls {

            display: flex;

            flex-direction: column;

            gap: 20px;

            margin-top: 30px;

        }

        

        .control-group {

            display: flex;

            align-items: center;

            gap: 15px;

            justify-content: center;

            flex-wrap: wrap;

        }

        

        .btn {

            padding: 12px 30px;

            font-size: 1em;

            border: none;

            border-radius: 8px;

            cursor: pointer;

            font-weight: bold;

            transition: all 0.3s ease;

        }

        

        .btn-primary {

            background: #00a86b;

            color: white;

        }

        

        .btn-primary:hover {

            background: #008558;

            transform: translateY(-2px);

            box-shadow: 0 5px 15px rgba(0, 168, 107, 0.3);

        }

        

        .btn-secondary {

            background: #6c757d;

            color: white;

        }

        

        .btn-secondary:hover {

            background: #5a6268;

            transform: translateY(-2px);

        }

        

        .volume-control {

            display: flex;

            align-items: center;

            gap: 10px;

        }

        

        .volume-slider {

            width: 150px;

            height: 6px;

            border-radius: 3px;

            outline: none;

            background: #ddd;

        }

        

        audio {

            display: none;

        }

        

        .toast {

            position: fixed;

            bottom: -100px;

            right: 20px;

            padding: 15px 25px;

            border-radius: 8px;

            color: white;

            font-weight: bold;

            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);

            transition: bottom 0.3s ease;

            z-index: 1000;

        }

        

        .toast.show {

            bottom: 20px;

        }

        

        .toast-success { background: #00a86b; }

        .toast-error { background: #dc3545; }

        .toast-info { background: #17a2b8; }

        

        footer {

            text-align: center;

            padding: 30px;

            margin-top: 50px;

            background: #f8f9fa;

            color: #666;

            border-top: 3px solid #00a86b;

        }

        

        @media (max-width: 768px) {

            .logo { font-size: 1.8em; }

            .clock { font-size: 2em; }

            .player-section { padding: 20px; }

        }

    </style>

</head>

<body>

    <header>

        <div class=\"container\">

            <div class=\"logo\">📻 Rádio 24H Supermercado do Louro</div>

            <div class=\"tagline\">Sua rádio online tocando 24 horas por dia!</div>

        </div>

    </header>

    <main class=\"container\">

        <section class=\"player-section\">

            <div class=\"clock-section\">

                <div class=\"clock\" id=\"currentTime\">00:00:00</div>

                <div class=\"current-hour\">Programa das <span id=\"currentHour\">00:00</span></div>

                <div class=\"countdown\" id=\"countdown\">Próxima hora em: 00:00</div>

            </div>

            <div class=\"live-indicator\" id=\"liveIndicator\">

                <div class=\"live-dot\"></div>

                <span>NO AR</span>

            </div>

            <div class=\"status-section\">

                <div class=\"status-live\" id=\"programStatus\">Carregando...</div>

                <div class=\"status-message\" id=\"statusMessage\"></div>

            </div>

            <div class=\"player-controls\">

                <div class=\"control-group\">

                    <button class=\"btn btn-primary\" id=\"playPauseBtn\">▶️ Reproduzir</button>

                    <button class=\"btn btn-secondary\" id=\"syncBtn\">🔄 Sincronizar</button>

                </div>

                

                <div class=\"control-group\">

                    <div class=\"volume-control\">

                        <span>🔊 Volume:</span>

                        <input type=\"range\" min=\"0\" max=\"100\" value=\"70\" class=\"volume-slider\" id=\"volumeControl\">

                        <span id=\"volumeValue\">70%</span>

                    </div>

                </div>

            </div>

            <audio id=\"audioPlayer\" preload=\"auto\"></audio>

        </section>

    </main>

    <footer>

        <p>&copy; 2024 Rádio 24H Supermercado do Louro</p>

    </footer>

    <script>

        // Configuração

        const CONFIG = {

            supabase: {

                url: 'https://dyzjsgfoaxyeyepoylvg.supabase.co',

                anonKey: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImR5empzZ2ZvYXh5ZXllcG95bHZnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk1ODUzNjUsImV4cCI6MjA3NTE2MTM2NX0.PwmaMI04EhcTqUQioTRInyVKUlw3t1ap0lM5hI29s2I'

            }

        };

        // Cliente Supabase

        let supabaseClient = null;

        function initSupabase() {

            if (!supabaseClient) {

                supabaseClient = supabase.createClient(CONFIG.supabase.url, CONFIG.supabase.anonKey);

            }

            return supabaseClient;

        }

        async function getProgramacaoPorHora(hora) {

            const client = initSupabase();

            const { data, error } = await client

                .from('programacao_hourly')

                .select('*')

                .eq('hour', hora)

                .eq('enabled', true)

                .single();

            

            if (error) {

                console.error('Erro ao buscar programação:', error);

                return null;

            }

            

            return data;

        }

        function subscribeToChanges(callback) {

            const client = initSupabase();

            

            const subscription = client

                .channel('programacao_changes')

                .on('postgres_changes', {

                    event: '*',

                    schema: 'public',

                    table: 'programacao_hourly'

                }, (payload) => {

                    console.log('Mudança detectada:', payload);

                    callback(payload);

                })

                .subscribe();

            

            return subscription;

        }

        // Variáveis do player

        let audioPlayer = null;

        let currentHour = -1;

        let realtimeSubscription = null;

        function initPlayer() {

            audioPlayer = document.getElementById('audioPlayer');

            

            updateClock();

            setInterval(updateClock, 1000);

            

            loadCurrentProgram();

            setInterval(checkHourChange, 60000);

            

            audioPlayer.addEventListener('ended', () => audioPlayer.play());

            

            document.getElementById('playPauseBtn').addEventListener('click', togglePlayPause);

            document.getElementById('volumeControl').addEventListener('input', changeVolume);

            document.getElementById('syncBtn').addEventListener('click', syncNow);

            

            initRealtimeSync();

            

            console.log('Player inicializado!');

        }

        function updateClock() {

            const now = new Date();

            const hours = String(now.getHours()).padStart(2, '0');

            const minutes = String(now.getMinutes()).padStart(2, '0');

            const seconds = String(now.getSeconds()).padStart(2, '0');

            

            document.getElementById('currentTime').textContent = `${hours}:${minutes}:${seconds}`;

            

            const remainingMinutes = 59 - now.getMinutes();

            const remainingSeconds = 59 - now.getSeconds();

            document.getElementById('countdown').textContent = 

                `Próxima hora em: ${String(remainingMinutes).padStart(2, '0')}:${String(remainingSeconds).padStart(2, '0')}`;

        }

        async function loadCurrentProgram() {

            const now = new Date();

            const hora = now.getHours();

            

            if (hora === currentHour) return;

            

            currentHour = hora;

            document.getElementById('currentHour').textContent = `${String(hora).padStart(2, '0')}:00`;

            

            const programa = await getProgramacaoPorHora(hora);

            

            if (programa && programa.url_audio) {

                console.log('Carregando programa:', hora, programa);

                loadAudio(programa.url_audio);

                document.getElementById('programStatus').textContent = 'Tocando agora';

                document.getElementById('programStatus').className = 'status-live';

                document.getElementById('statusMessage').textContent = '';

                document.getElementById('liveIndicator').style.display = 'flex';

            } else {

                console.log('Nenhum programa disponível para hora:', hora);

                document.getElementById('programStatus').textContent = 'Fora do ar';

                document.getElementById('programStatus').className = 'status-offline';

                document.getElementById('statusMessage').textContent = 'Programação temporariamente indisponível';

                document.getElementById('liveIndicator').style.display = 'none';

                audioPlayer.pause();

                audioPlayer.src = '';

            }

        }

        function loadAudio(url) {

            if (audioPlayer.src !== url) {

                audioPlayer.src = url;

                audioPlayer.load();

                audioPlayer.play().catch(error => {

                    console.error('Erro ao reproduzir:', error);

                    showMessage('Clique em Play para iniciar', 'info');

                });

            }

        }

        function checkHourChange() {

            const hora = new Date().getHours();

            if (hora !== currentHour) {

                console.log('Mudança de hora:', currentHour, '->', hora);

                loadCurrentProgram();

            }

        }

        function togglePlayPause() {

            const btn = document.getElementById('playPauseBtn');

            if (audioPlayer.paused) {

                audioPlayer.play();

                btn.textContent = '⏸️ Pausar';

            } else {

                audioPlayer.pause();

                btn.textContent = '▶️ Reproduzir';

            }

        }

        function changeVolume(event) {

            audioPlayer.volume = event.target.value / 100;

            document.getElementById('volumeValue').textContent = event.target.value + '%';

        }

        function syncNow() {

            console.log('Sincronização manual');

            currentHour = -1;

            loadCurrentProgram();

            showMessage('Sincronizado!', 'success');

        }

        function initRealtimeSync() {

            realtimeSubscription = subscribeToChanges((payload) => {

                console.log('Mudança em tempo real:', payload);

                const hora = new Date().getHours();

                if (payload.new && payload.new.hour === hora) {

                    console.log('Atualização detectada!');

                    currentHour = -1;

                    loadCurrentProgram();

                    showMessage('Programação atualizada!', 'info');

                }

            });

        }

        function showMessage(text, type = 'info') {

            const messageDiv = document.createElement('div');

            messageDiv.className = `toast toast-${type}`;

            messageDiv.textContent = text;

            

            document.body.appendChild(messageDiv);

            

            setTimeout(() => messageDiv.classList.add('show'), 10);

            setTimeout(() => {

                messageDiv.classList.remove('show');

                setTimeout(() => messageDiv.remove(), 300);

            }, 3000);

        }

        // Inicializar

        if (document.readyState === 'loading') {

            document.addEventListener('DOMContentLoaded', initPlayer);

        } else {

            initPlayer();

        }

    </script>

</body>

</html>
